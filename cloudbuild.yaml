steps:
- name: node:14
  entrypoint: npm
  args: ['install', 'typescript']
- name: node:14
  entrypoint: npm
  args: ['install']
  # run webpack prod script to create static files
- name: node:14
  entrypoint: npm
  args: ['run','build']
  env:
    - 'REACT_APP_API_KEY=${eyJzb3VsSWQiOiJkZG5hLWRhcnRtb3V0aC1jb2xsZWdlYmU0Zi0tbm9haGRlcGxveW1lbnQiLCJhdXRoU2VydmVyIjoiaHR0cHM6Ly9kaC5hei5zb3VsbWFjaGluZXMuY2xvdWQvYXBpL2p3dCIsImF1dGhUb2tlbiI6ImFwaWtleV92MV82OGYyYWZjNi1lNjg2LTQ1ZTItODViYS0wY2U4ZTBmMzcxZGMifQ==}'
    - 'REACT_APP_GA_TRACKING_ID=G-G5GWJ2XYRS'
    - 'DISABLE_ESLINT_PLUGIN=true'
    - 'REACT_APP_SESSION_SERVER=${_SESSION_SERVER}'
    - 'REACT_APP_PERSONA_AUTH_MODE=0'
    - 'REACT_APP_ORCHESTRATION_MODE=false'
    - 'GENERATE_SOURCEMAP=false'
- name: "gcr.io/cloud-builders/gcloud"
  args: ["app", "deploy"]
timeout: "1600s"
